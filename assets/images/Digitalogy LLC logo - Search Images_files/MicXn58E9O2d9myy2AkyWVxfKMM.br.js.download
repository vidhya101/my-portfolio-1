var InstNode,InstWriter,DsInstrumentation,__rest,InstItemFactory,LayoutInst,DsSerializer,InstTracker,GlobalInstTracker;(function(n){class t{constructor(n,t){this.instrumentation={};this.parent=n;this.arrayPropertyName=t;this.isOpened=!0}closeNode(){this.isOpened=!1}isNodeOpen(){return this.isOpened}getParentNode(){return this.parent}write(n,t){this.instrumentation[n]=t}beginArray(){this.instrumentation[this.arrayPropertyName]=[]}addItemInArray(n){this.instrumentation.hasOwnProperty(this.arrayPropertyName)&&this.instrumentation[this.arrayPropertyName]&&this.instrumentation[this.arrayPropertyName].push(n.getInstrumentationObject())}getInstrumentationObject(){return this.instrumentation}}n.InstrumentationNode=t;window.InstrumentationNode=t})(InstNode||(InstNode={})),function(n){class t{constructor(n){this.nodes={};this.instrumentationArray=[];this.currentNode=null;this.arrayPropertyName=n}beginObject(n,t){var i=new InstNode.InstrumentationNode(this.currentNode,this.arrayPropertyName);if(typeof t!="undefined"&&t){if(!this.nodes.hasOwnProperty(t))throw"Parent (name) "+t+" instrumentation node is not found.";i=new InstNode.InstrumentationNode(this.nodes[t],this.arrayPropertyName);this.nodes[t].addItemInArray(i)}else this.currentNode===null?this.instrumentationArray.push(i):this.currentNode.addItemInArray(i);if(typeof n!="undefined"&&n){if(this.nodes.hasOwnProperty(n))throw n+" node is already exist.";this.nodes[n]=i}return this.currentNode=i,i}closeObject(){if(this.currentNode===null)throw"There is no opened Object. Make sure you don't called close object more than once for one object.";var n=this.currentNode;this.currentNode=n.getParentNode();n.closeNode()}getInstrumentationObject(){var t,n;if(this.instrumentationArray=this.instrumentationArray.filter(n=>n!=null),this.instrumentationArray.length===0)return null;for(t=new Array(this.instrumentationArray.length),n=0;n<this.instrumentationArray.length;n++)t[n]=this.instrumentationArray[n].getInstrumentationObject();return t}clear(){this.nodes={};this.currentNode=null;this.instrumentationArray=[]}}n.InstrumentationWriter=t;window.InstrumentationWriter=t}(InstWriter||(InstWriter={})),function(n){class t{constructor(){this.parentNameSpace=[""];this.writer=new InstWriter.InstrumentationWriter("DS")}isValidString(n){return!(typeof n=="undefined"||n===null||n.length===0)}isValidNumber(n){return!(typeof n=="undefined"||n===null)}startObject(n,t,i){var r=this.writer.beginObject(t,i);for(let t in n)r.write(t,n[t]);r.beginArray()}closeObject(){this.writer.closeObject()}startLink(n,t,i,r){var u=this.writer.beginObject(i,r);u.write("T","D.Url");this.isValidString(n.UniqueId.Namespace)&&u.write("AppNS",n.UniqueId.Namespace);this.isValidString(n.UniqueId.K)&&u.write("K",n.UniqueId.K);this.isValidString(n.Service)&&u.write("Service",n.Service);this.isValidString(n.Scenario)&&u.write("Scenario",n.Scenario);this.isValidString(n.Name)&&u.write("N",n.Name);this.isValidString(n.Url)&&u.write("Url",n.Url);this.isValidString(n.Role)&&u.write("R",n.Role);this.isValidString(n.Text)&&u.write("Tx",n.Text);this.isValidString(n.Vertical)&&u.write("V",n.Vertical);this.isValidString(n.SubVertical)&&u.write("SV",n.SubVertical);this.isValidString(n.Source)&&u.write("S",n.Source)}closeLink(){this.writer.closeObject()}startItem(n,t,i){var r=this.writer.beginObject(t,i);r.write("T","D.Item");this.isValidString(n.UniqueId.Namespace)&&r.write("AppNS",n.UniqueId.Namespace);this.isValidString(n.UniqueId.K)&&r.write("K",n.UniqueId.K);this.isValidString(n.Service)&&r.write("Service",n.Service);this.isValidString(n.Scenario)&&r.write("Scenario",n.Scenario);this.isValidString(n.Name)&&r.write("N",n.Name);this.isValidString(n.Role)&&r.write("R",n.Role);this.isValidString(n.Text)&&r.write("Tx",n.Text);this.isValidString(n.Vertical)&&r.write("V",n.Vertical);this.isValidString(n.Source)&&r.write("S",n.Source);r.beginArray()}closeItem(){this.writer.closeObject()}getInstrumentationObjectAndClear(){var n=this.writer.getInstrumentationObject();return this.writer.clear(),n}getInstrumentationString(){return JSON.stringify(this.writer.getInstrumentationObject())}}n.DataSourceInstrumentation=t;window.DataSourceInstrumentation=t}(DsInstrumentation||(DsInstrumentation={}));__rest=this&&this.__rest||function(n,t){var u={},r;for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(u[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(u[i[r]]=n[i[r]]);return u},function(n){class t{constructor(n,t=6e3){this.lastId=t;this.namespace=n;this.kValueToInstData=new Map}createInstrumentedItem(n){let t=this.getUniqueId(),i=Object.assign({T:"D.Item",UniqueId:t,CurrentUseCount:0,InstType:"Item"},n!==null&&n!==void 0?n:{});return this.kValueToInstData.set(t.K.toString(),i),i}createInstrumentedItemFromObject(n){let{K:t,CurrentUseCount:i,AppNS:r}=n,e=__rest(n,["K","CurrentUseCount","AppNS"]),u=t?{K:t,Namespace:r?r:this.namespace}:this.getUniqueId(),f=Object.assign({T:"D.Item",UniqueId:u,CurrentUseCount:i?i-1:0,InstType:"Item"},e);return this.kValueToInstData.set(u.K.toString(),f),f}createLink(n,t){return this.createLinkFromObject({Url:n,FormCode:t})}createLinkFromObject(n){let t=n.Url,r=n.FormCode,u=n.K,f=n.CurrentUseCount,i="",e=n.AppNS;if(t)if(this.isFormCodeApplicable(t)&&r){let u,n=t.indexOf("#");u=n>-1?t.substring(0,n):t;i=u;i+=u.indexOf("?")>-1?"&":"?";i+="FORM=";i+=r;n>-1&&(i+=t.substring(n))}else i=t;let o=u?{K:u,Namespace:e?e:this.namespace}:this.getUniqueId(),s={InstType:"Link",T:"D.Url",UniqueId:o,Url:t,UrlWithFormCode:i,CurrentUseCount:f?f-1:0};return this.kValueToInstData.set(o.K.toString(),s),s}createRegion(n,t,i,r){let u=this.getUniqueId(),f={T:t?t:"L.Box",UniqueId:u,DisplayRegion:n,InsertId:i,InsertRef:r};return this.kValueToInstData.set(u.K.toString(),f),f}createRegionFromK(n,t,i,r,u){let f={T:i?i:"L.Box",UniqueId:{K:t,Namespace:this.namespace},DisplayRegion:n,InsertId:r,InsertRef:u};return this.kValueToInstData.set(t.toString(),f),f}getUniqueId(){return{K:this.getAndIncrementLastId(),Namespace:this.namespace}}getAndIncrementLastId(){return this.lastId++}getNamespace(){return this.namespace}setNamespace(n){this.namespace=n}isFormCodeApplicable(n){if(!n)return!1;let t=n.indexOf("FORM=");return t>0&&(n[t-1]=="?"||n[t-1]=="&")?!1:n.startsWith("http://")||n.startsWith("https://")||n.startsWith("ftp://")||n.startsWith("ans://")||n.startsWith("javascript:")||n.startsWith("mms://")?!1:!0}}n.InstrumentedItemFactory=t;window.InstrumentedItemFactory=t}(InstItemFactory||(InstItemFactory={})),function(n){class t{constructor(){this.pageName="ClientPage";this.pageNumber=1;this.writer=new InstWriter.InstrumentationWriter("L")}isValidString(n){return!(typeof n=="undefined"||n===null||n.length===0)}isValidNumber(n){return!(typeof n=="undefined"||n===null)}setPageInfo(n,t){this.pageNumber=t}setNamespaceInfo(n,t){this.sfx=t;this.insertRef=n}startLink(n,t,i,r){let u=this.writer.beginObject(t,i);u.write("T","L.Url");let e=n.UniqueId;u.write("AppNS",e.Namespace);let f=e.K+".";r?f+=r:(n.CurrentUseCount++,f+=n.CurrentUseCount);u.write("K",f)}closeLink(){this.writer.closeObject()}startItem(n,t,i,r){let u=this.writer.beginObject(t,i);u.write("T","L.Item");let e=n.UniqueId;u.write("AppNS",e.Namespace);let f=e.K+".";r?f+=r:(n.CurrentUseCount++,f+=n.CurrentUseCount);u.write("K",f)}closeItem(){this.writer.closeObject()}startForm(n,t,i){let u=this.writer.beginObject(t,i);u.write("T","L.Form");n.CurrentUseCount++;let r=n.UniqueId;this.isValidString(r.Namespace)&&u.write("AppNS",r.Namespace);this.isValidNumber(r.K)&&u.write("K",r.K+"."+n.CurrentUseCount)}closeForm(){this.writer.closeObject()}startRegion(n,t,i){let r=this.writer.beginObject(t,i);this.isValidString(n.T)&&r.write("T",n.T);let u=this.insertRef+"_"+this.sfx;this.isValidString(u)&&r.write("AppNS",u);this.isValidString(n.DisplayRegion)&&r.write("Region",n.DisplayRegion);this.isValidString(n.DisplayRegion)&&r.write("InsertId",n.InsertId);r.beginArray()}closeRegion(){this.writer.closeObject()}getInstrumentationObjectAndClear(){let n=this.writer.getInstrumentationObject();return this.writer.clear(),{Name:this.pageName,Number:this.pageNumber,SFX:this.sfx,IID:this.insertRef,L:n}}getInstrumentationString(){return JSON.stringify(this.writer.getInstrumentationObject())}}n.LayoutInstrumentation=t;window.LayoutInstrumentation=t}(LayoutInst||(LayoutInst={})),function(n){class t{constructor(n){this.dataSourceInst=n.dataSourceInst;this.instItemFactory=n.itemFactory;this.layoutInst=n.layoutInst}serializeLinksToJson(n,t){let i=this.instItemFactory.createInstrumentedItem(),r=Object.assign({T:"D.Top",K:i.UniqueId.K,AppNS:i.UniqueId.Namespace},t!==null&&t!==void 0?t:{});this.dataSourceInst.startObject(r);for(let t of n)this.dataSourceInst.startLink(t,!0),this.dataSourceInst.closeLink();this.dataSourceInst.closeObject()}serializeTopLevelFields(n,t){let i=Object.assign({T:t?t:"D.Top"},n!==null&&n!==void 0?n:{});this.dataSourceInst.startObject(i);this.dataSourceInst.closeObject()}serializeItemsToJson(n,t){let i=this.instItemFactory.createInstrumentedItem(),r=Object.assign({T:"D.Top",K:i.UniqueId.K,AppNS:i.UniqueId.Namespace},t!==null&&t!==void 0?t:{});this.dataSourceInst.startObject(r);for(let t of n)this.dataSourceInst.startItem(t),this.dataSourceInst.closeItem();this.dataSourceInst.closeObject()}serializeFormToJson(n){let t={T:"D.Form",K:n.UniqueId.K,AppNS:n.UniqueId.Namespace,Url:n.UrlWithFormCode};this.dataSourceInst.startObject(t);this.dataSourceInst.closeObject()}}n.DataSourceSerializer=t;window.DataSourceSerializer=t}(DsSerializer||(DsSerializer={})),function(n){class t{constructor(n,t){this.sfx=1;this.insertRef=n;this.layoutInst=new LayoutInst.LayoutInstrumentation;this.layoutInst.setPageInfo(t,0);this.layoutInst.setNamespaceInfo(n,this.sfx);this.dataSourceInst=new DsInstrumentation.DataSourceInstrumentation;this.itemFactory=new InstItemFactory.InstrumentedItemFactory(n+"_"+this.sfx);this.dataSourceSerializer=new DsSerializer.DataSourceSerializer(this);this.layoutInstDupKeys=new Set}flushInstrumentation(n){let t=this.dataSourceInst.getInstrumentationObjectAndClear(),i=this.layoutInst.getInstrumentationObjectAndClear();window.cspi_log&&window.cspi_log({OvrIG:n},t?t:[],i);this.prepareNewPartialImpression()}prepareNewPartialImpression(){this.sfx++;this.itemFactory.setNamespace(this.insertRef+"_"+this.sfx);this.layoutInst.setNamespaceInfo(this.insertRef,this.sfx)}dedupeLayout(n){let t=n.UniqueId.Namespace+","+n.UniqueId.K+"."+n.CurrentUseCount;return this.layoutInstDupKeys.has(t)?(console.log("Duplicate UniqueId detected in layout: "+t+" Skipped writing Item to layout"),!0):(this.layoutInstDupKeys.add(t),!1)}writeLayoutFromElement(n){if(n){let i=n.dataset.cspi,r=n.dataset.cspiovr,u=this.itemFactory.kValueToInstData,t;if(i)if(u.has(i))t="Region",this.layoutInst.startRegion(u.get(i));else{let u=i.split(","),n,f,e;if(u.length===2){let t=u[1].split(".");t.length===2&&(e=t[0],f=t[1],n=this.itemFactory.kValueToInstData.get(e))}if(r){let i=parseInt(e);if(i){let e=JSON.parse(r);if(t=e.InstType,e.K=i,u[0]){let n=u[0].split("=");n.length===2&&n[0]==="ID"&&(e.AppNS=n[1])}e.CurrentUseCount=parseInt(f);switch(t){case"Link":n=this.itemFactory.createLinkFromObject(e);break;case"Item":n=this.itemFactory.createInstrumentedItemFromObject(e)}}}if(n){t=n.InstType;switch(t){case"Link":n.UniqueId&&!this.dedupeLayout(n)&&(this.layoutInst.startLink(n,null,null,f),this.layoutInst.closeLink());break;case"Item":n.UniqueId&&!this.dedupeLayout(n)&&(this.layoutInst.startItem(n,null,null,f),this.layoutInst.closeItem())}}}let f;f=n.shadowRoot?n.shadowRoot.children:n.children;for(let n of Array.from(f))n instanceof HTMLElement&&this.writeLayoutFromElement(n);t==="Region"&&this.layoutInst.closeRegion()}}}n.InstrumentationTracker=t;window.InstrumentationTracker=t}(InstTracker||(InstTracker={})),function(n){function r(n,i){let r=n;if(i&&(r=i+"-"+n),t.get(r))return console.log("There is already and InstrumentationTracker instance associated with this insertRef:"+r),null;let u=new InstTracker.InstrumentationTracker(r,i);return t.set(r,u),u}function u(n){return t.get(n)}function f(n,t){let r=i+`?InsertId=${n}`;t&&(r=i+`?InsertId=${t}-${n}`);const u=location.href.indexOf("?");return u!==-1&&(r+="&"+location.href.substring(u+1)),new Promise((n,t)=>{if(typeof sj_gx!="undefined"&&window.sj_gx){const i=u=>{var f=window.sj_gx();f.onreadystatechange=function(){if(f.readyState===4)if(f.status!==200&&u>0)i(u-1);else if(f.status!==200&&u===0)t(new Error("generateNewBaseImpressionAsync: Request was not successful after retries. Last HTTP request status: "+f.status));else{let t=document.createElement("html");t.innerHTML=f.responseText;let i=t.getElementsByTagName("div");const r=i.item(0).innerHTML;n(r)}};f.onerror=function(){t(new Error("generateNewBaseImpressionAsync: XMLHttpRequest Error"))};f.open("GET",r,!0);f.setRequestHeader("content-type","application/json");f.send()};i(2)}else t(new Error("generateNewBaseImpressionAsync: sj_gx is not defined"))})}function e(n){return"ID="+n.UniqueId.Namespace+","+n.UniqueId.K+"."+ ++n.CurrentUseCount}var t=new Map;const i="/ClientSidePartialImpression/BasicImpression";n.createInstTracker=r;n.getInstTracker=u;n.generateNewBaseImpressionAsync=f;n.composeHValue=e}(GlobalInstTracker||(GlobalInstTracker={}))